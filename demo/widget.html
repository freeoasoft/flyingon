<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>flyingon视图模型演示</title>
    <link rel="stylesheet" type="text/css" href="../css/default/flyingon.css"></link>
</head>
<body>

    <div style="position: absolute;left:0;top:0;right:0;bottom:0;width:auto;height:auto;">
        <div id="host" style="position:relative;width:100%;height:100%;margin:0;border:0;padding:0;overflow:hidden;"></div>
    </div>

    <script type="text/x-template" id="template">
        <panel :layout="layout" padding="10">
            <item-demo -loop="items(item, index)" :item-text="item.text" :item-index="index" :subitems="item.items" @click="operate_click(item, index)" />
            <label :visible="detail" :text="operate.detail.text" />
        </panel>
    </script>


    <script type="text/javascript" src="../js/flyingon.js"></script>
    
    <script type="text/javascript">


        flyingon.widget('item-demo', {

            template: {
                xtype: 'div',
                height: 65,
                children: [
                    { xtype: 'label', width: 90, ':text': 'item_label(itemIndex)', style: 'display:inline-block;' },
                    { xtype: 'textbox', ':value': 'itemText', width: 120, '-model': 'itemText' },
                    { xtype: 'button', ':text': 'operate.add', tag: 'add', margin: '0 5' },
                    { xtype: 'button', ':text': 'operate.edit', tag: 'edit' },
                    { xtype: 'button', ':text': 'operate.remove', tag: 'remove', margin: '0 5' },
                    { xtype: 'panel', layout: 'vertical-line', width: 'auto', height: 50, padding: '4 0 4 90', style:'overflow:hidden;', 
                        children: [
                            { xtype: 'div', '-loop': 'subitems(subitem)', ':width': 'subitem_width(subitem)', height: 5, style: 'background-color:silver;' }
                        ]
                    }
                ]
            },

            defaults: {
                operate: {
                    add: 'add',
                    edit: 'edit',
                    remove: 'remove',
                    detail: {
                        text: 'text ...'
                    }
                }
            },

            init: function () {


                this.item_label = function (index) {

                    return ++index + '. ' + this.$get('itemText'); //item.text写法不追踪变化
                };


                this.subitem_width = function (value) {

                    return value * 10 + 20;
                };

            }

        });


        var data = [];

        for (var i = 0; i < 100; i++)
        {
            data.push({ text: 'text ' + i, items: ('' + (Math.random() * 100000 | 0)).split('') });
        }



        var host = flyingon.view({
            
            host: 'host',

            template: '#template',

            defaults: {

                layout: 'vertical-line',

                detail: true,
                
                items: data
            },

            init: function (vm) {


                this.operate_click = function (item, index, control, event) {
                        
                    switch (event.target.tag())
                    {
                        case 'add':
                            this.items.push({ text: Math.random() * 10000000 | 0, items: ('' + (Math.random() * 100000 | 0)).split('') });
                            break;

                        case 'edit':
                            //item.$set('text', Math.random() * 10000000 | 0);
                            item.$replace({ 'text': Math.random() * 10000000 | 0, items: ('' + (Math.random() * 100000 | 0)).split('') });
                            break;

                        case 'remove':
                            this.items.splice(index, 1);
                            break;
                    }
                };


              
                this.$watch(function (data) {

                    //debugger
                });


            }


        });


  

    </script>

</body>
</html>