<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>flyingon视图模型演示</title>
    <link rel="stylesheet" type="text/css" href="../css/default/flyingon.css"></link>
</head>
<body>

    <div style="position: absolute;left:0;top:0;right:0;bottom:0;width:auto;height:auto;">
        <div id="host" style="position:relative;width:100%;height:100%;margin:0;border:0;padding:0;overflow:hidden;"></div>
    </div>

    <script type="text/x-template" id="template">
        <panel :layout="layout" padding="10">
            <item-demo -loop="items(item, index)" :item-text="item.text" :item-index="index" :subitems="item.items" @click="operate_click(item, index)" />
            <label :visible="detail" :text="operate.detail.text" />
        </panel>
    </script>


    <script type="text/javascript" src="../js/flyingon.js"></script>
    
    <script type="text/javascript">


        flyingon.widget('item-demo', {

            template: {
                xtype: 'div',
                height: 50,
                children: [
                    { xtype: 'label', ':text': 'itemIndex' },
                    { xtype: 'textbox', ':value': 'itemText', width: 120, margin: '0 10' },
                    { xtype: 'button', ':text': 'operate.add', tag: 'add' },
                    { xtype: 'button', ':text': 'operate.edit', tag: 'edit' },
                    { xtype: 'button', ':text': 'operate.remove', tag: 'remove' },
                    { xtype: 'panel', layout: 'line', width: 200, height: 20, overflowX: 'hidden', overflowY: 'hidden', 
                        children: [
                            { xtype: 'label', '-loop': 'subitems(subitem)', width: '30', height: '15', ':text': 'subitem' }
                        ]
                    }
                ]
            },

            defaults: {
                operate: {
                    add: 'add',
                    edit: 'edit',
                    remove: 'remove',
                    detail: {
                        text: 'text ...'
                    }
                }
            },

            init: function () {

                

            }

        });


        var data = [];

        for (var i = 0; i < 100; i++)
        {
            data.push({ text: 'text ' + i, items: ('' + (Math.random() * 100000 | 0)).split('') });
        }



        var host = flyingon.view({
            
            host: 'host',

            template: '#template',

            defaults: {

                layout: 'vertical-line',

                detail: true,
                
                items: data
            },

            init: function (vm) {

             
                this.operate_click = function (item, index, control, event) {
                        
                    switch (event.target.tag())
                    {
                        case 'add':
                            this.items.push({ text: 'added', items: ('' + (Math.random() * 100000 | 0)).split('') });
                            break;

                        case 'edit':
                            item.$set('text', new Date().getTime());
                            break;

                        case 'remove':
                            this.items.splice(index - 1, 1);
                            break;
                    }
                };


              
                this.$watch(function (data) {

                    //debugger
                });


            }


        });


  

    </script>

</body>
</html>