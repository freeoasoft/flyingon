<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>flyingon视图模型演示</title>
    <link rel="stylesheet" type="text/css" href="../css/default/flyingon.css"></link>
</head>
<body style="padding:10px;">

    <div id="host"></div>

    <script type="text/x-template" id="template">
        <panel :layout="layout" -class:active="active" background-color="silver">
            <panel height="auto" -loop="items(item, index)" @click="operate_click(item, index)">
                <label width="120" :text="item_label(item, index)" />
                <textbox width="120" :text="item.text" -model="item.text" />
                <button tag="add" :text="operate.add" />
                <button tag="edit" :text="operate.edit" />
                <button tag="remove" :text="operate.remove" />
                <label -loop="item.items(subitem)" :text="subitem"/>
            </panel>
            <label :visible="detail" :text="operate.detail.text" />
        </panel>
    </script>
            

    <script type="text/javascript" src="../js/flyingon.js"></script>
    
    <script type="text/javascript">



        // vm.items.$get();
        // vm.items.$set([]);

        // vm.items.push();
        // vm.items.splice([]);

        // vm.items[2].items[2].$get();
        // vm.items[2].items[2].$set([]);

        // vm.items[2].text();
        // vm.items[2].text('dd');

        // vm.operate.$get();
        // vm.operate.$set({});
        // vm.operate.detail.text();
        // vm.operate.detail.text('ddd');

        // vm.layout();



        var host = flyingon.view({
            
            host: 'host',

            template: '#template',

            defaults: {

                layout: 'vertical-line',

                detail: true,
                
                items: [
                    { text: 'text 1', items: ['A', 'C'] },
                    { text: 'text 2', items: ['B', 'C'] },
                    { text: 'text 3', items: ['A', 'D'] }
                ],

                operate: {
                    add: 'add',
                    edit: 'edit',
                    remove: 'remove',
                    detail: {
                        text: 'text ...'
                    }
                }
            },

            controller: function () {

             
                this.item_label = function (item, index) {

                    return index + '. ' + item.text();
                };


                this.operate_click = function (item, index, control, event) {

                    switch (event.target.tag())
                    {
                        case 'add':
                            this.items.append({ text: 'added', items: ['D'] });
                            break;

                        case 'edit':
                            item.text(new Date().getTime());
                            break;

                        case 'remove':
                            this.items.removeAt(index);
                            break;
                    }
                };


                this.items.$watch('text', function (event) {

                });


                this.$watch('operate', function (event) {

                });


            }


        });



    </script>

</body>
</html>